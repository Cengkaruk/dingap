#------------------------------------------------------------------------------
# P A C K A G E  I N F O
#------------------------------------------------------------------------------

Name: app-base
Group: Applications/Modules
Version: %package_version%
Release: %package_release%
Summary: %package_title%
License: %package_license%
Packager: %package_packager%
Vendor: %package_vendor%
Source: app-base-%{version}.tar.gz
Requires: %{name}-core = %{version}-%{release}
Requires: clearos-theme
Provides: app-webconfig-default
Obsoletes: app-webconfig-default
Buildarch: noarch
Buildroot: %_tmppath/%name-%version-buildroot

%description
%package_description%

%package core
Summary: Core API and install for %{name}
Group: System Environment/API
Requires: clearos-base = %package_version%
Requires: clearos-framework = %package_version%
# Most of these are derived from the required sudo entries defined below
Requires: chkconfig
Requires: coreutils 
Requires: ethtool
Requires: file
Requires: initscripts
Requires: net-tools
Requires: sudo
Requires: SysVinit
Requires: util-linux
Requires: webconfig-php
Requires: webconfig-utils

%description core
Core API and install for %{name}

#------------------------------------------------------------------------------
# B U I L D
#------------------------------------------------------------------------------

%prep
%setup
%build

#------------------------------------------------------------------------------
# I N S T A L L  F I L E S
#------------------------------------------------------------------------------

%install
rm -rf $RPM_BUILD_ROOT

mkdir -p -m 755 $RPM_BUILD_ROOT/usr/clearos/apps/base

cp -r * $RPM_BUILD_ROOT/usr/clearos/apps/base/

#------------------------------------------------------------------------------
# I N S T A L L  S C R I P T
#------------------------------------------------------------------------------

%post
logger -p local6.notice -t installer "app-base - installing"

%post core
logger -p local6.notice -t installer "app-base-core - installing"

[ -x /usr/clearos/apps/base/deploy/install ] && /usr/clearos/apps/base/deploy/install
[ -x /usr/clearos/apps/base/deploy/upgrade ] && /usr/clearos/apps/base/deploy/upgrade

exit 0

#------------------------------------------------------------------------------
# U N I N S T A L L  S C R I P T
#------------------------------------------------------------------------------

%preun
if [ "$1" = 0 ]; then
	logger -p local6.notice -t installer "app-base - uninstalling"
fi

%preun core
if [ "$1" = 0 ]; then
	logger -p local6.notice -t installer "app-base-core - uninstalling"
	[ -x /usr/clearos/apps/base/deploy/uninstall ] && /usr/clearos/apps/base/deploy/uninstall
fi

exit 0

#------------------------------------------------------------------------------
# C L E A N  U P
#------------------------------------------------------------------------------

%clean
rm -rf $RPM_BUILD_ROOT

#------------------------------------------------------------------------------
# F I L E S
#------------------------------------------------------------------------------

%files
%defattr(-,root,root)
#/usr/clearos/apps/base/controllers
#/usr/clearos/apps/base/htdocs
/usr/clearos/apps/base/info
#/usr/clearos/apps/base/views

%files core
%defattr(-,root,root)
%exclude /usr/clearos/apps/base/packaging
%dir /usr/clearos/apps/base
/usr/clearos/apps/base/language
/usr/clearos/apps/base/libraries
/usr/clearos/apps/base/deploy
