#!/bin/sh

# Source sysconfig
[ -e /etc/sysconfig/cups ] && source /etc/sysconfig/cups

# Source auto-configure functions
[ -e /etc/init.d/functions-automagic ] && source /etc/init.d/functions-automagic
[ -e /etc/sysconfig/automagic ] && source /etc/sysconfig/automagic

# Bail if no-automagic is wanted
if [ "$AUTOMAGIC" == "off" ]; then
        return
fi

if [ -d /etc/cups ]; then
        echo "# Automatically generated by init script" > /etc/cups/cupsd.listen.conf
        for IP in $AUTOMAGIC_LANIPS 127.0.0.1; do
                echo "Listen $IP:631" >> /etc/cups/cupsd.listen.conf
        done
fi
