#------------------------------------------------------------------------------
# P A C K A G E  I N F O
#------------------------------------------------------------------------------

Name: app-cron
Group: Applications/Modules
Version: %package_version%
Release: %package_release%
Summary: %package_title%
License: %package_license%
Packager: %package_packager%
Vendor: %package_vendor%
Source: %{name}-%{version}.tar.gz
Requires: %{name}-core = %{version}-%{release}
Buildarch: noarch
Buildroot: %_tmppath/%name-%version-buildroot

%description
%package_description%

%package core
Summary: Core API and install for %{name}
Group: System Environment/API
Requires: app-base = %package_version%
Requires: cronie

%description core
Core API and install for %{name}

#------------------------------------------------------------------------------
# B U I L D
#------------------------------------------------------------------------------

%prep
%setup
%build

#------------------------------------------------------------------------------
# I N S T A L L  F I L E S
#------------------------------------------------------------------------------

%install
rm -rf $RPM_BUILD_ROOT

mkdir -p -m 755 $RPM_BUILD_ROOT/etc/cron.d
mkdir -p -m 755 $RPM_BUILD_ROOT/etc/system
mkdir -p -m 755 $RPM_BUILD_ROOT/usr/sbin
mkdir -p -m 755 $RPM_BUILD_ROOT/usr/clearos/apps/cron

cp -r * $RPM_BUILD_ROOT/usr/clearos/apps/cron/

#------------------------------------------------------------------------------
# I N S T A L L  S C R I P T
#------------------------------------------------------------------------------

%post
logger -p local6.notice -t installer "app-cron - installing"

%post core
logger -p local6.notice -t installer "app-cron-core - installing"

[ -x /usr/clearos/apps/cron/deploy/install ] && /usr/clearos/apps/cron/deploy/install
[ -x /usr/clearos/apps/cron/deploy/upgrade ] && /usr/clearos/apps/cron/deploy/upgrade

exit 0

#------------------------------------------------------------------------------
# U N I N S T A L L  S C R I P T
#------------------------------------------------------------------------------

%preun
if [ "$1" = 0 ]; then
	logger -p local6.notice -t installer "app-cron - uninstalling"
fi

exit 0

%preun core
if [ "$1" = 0 ]; then
	logger -p local6.notice -t installer "app-cron-core - uninstalling"
	[ -x /usr/clearos/apps/cron/deploy/uninstall ] && /usr/clearos/apps/cron/deploy/uninstall
fi

exit 0

#------------------------------------------------------------------------------
# C L E A N  U P
#------------------------------------------------------------------------------

%clean
rm -rf $RPM_BUILD_ROOT

#------------------------------------------------------------------------------
# F I L E S
#------------------------------------------------------------------------------

%files
%defattr(-,root,root)
/usr/clearos/apps/cron/controllers
/usr/clearos/apps/cron/htdocs
/usr/clearos/apps/cron/info
/usr/clearos/apps/cron/views

%files core
%defattr(-,root,root)
%exclude /usr/clearos/apps/cron/packaging
%dir /usr/clearos/apps/cron
/usr/clearos/apps/cron/language
/usr/clearos/apps/cron/libraries
/usr/clearos/apps/cron/deploy
