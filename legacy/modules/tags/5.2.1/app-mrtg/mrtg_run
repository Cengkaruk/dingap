#!/bin/sh

# No easy way around this... we need to check for new network interfaces on 
# every stat run.  IPsec, PPTPd, and wireless interfaces may come and go.
# We also check for changes in language settings.

echo "# Generated by mrtg_run" > /etc/mrtg/mrtg.cfg.dynamic
echo "" >> /etc/mrtg/mrtg.cfg.dynamic

echo "# Language" >> /etc/mrtg/mrtg.cfg.dynamic
echo "" >> /etc/mrtg/mrtg.cfg.dynamic

if [ -e /etc/sysconfig/i18n ]; then
	SYSLANG=`grep "LANG=" /etc/sysconfig/i18n | sed 's/"//g' | sed 's/.*=//' | sed 's/\..*//'`
fi

# MRTG does not use the standard language codes.  Doh!
# http://people.ee.ethz.ch/~oetiker/webtools/mrtg/reference.html
if [ -z "$SYSLANG" ]; then
	echo "Language: english" >> /etc/mrtg/mrtg.cfg.dynamic
elif [ "$SYSLANG" == "de_DE" ]; then
	echo "Language: german" >> /etc/mrtg/mrtg.cfg.dynamic
elif [ "$SYSLANG" == "en_US" ]; then
	echo "Language: english" >> /etc/mrtg/mrtg.cfg.dynamic
elif [ "$SYSLANG" == "es_ES" ]; then
	echo "Language: spanish" >> /etc/mrtg/mrtg.cfg.dynamic
elif [ "$SYSLANG" == "fr_FR" ]; then
	echo "Language: french" >> /etc/mrtg/mrtg.cfg.dynamic
elif [ "$SYSLANG" == "hu_HU" ]; then
	echo "Language: hungarian" >> /etc/mrtg/mrtg.cfg.dynamic
elif [ "$SYSLANG" == "it_IT" ]; then
	echo "Language: italian" >> /etc/mrtg/mrtg.cfg.dynamic
elif [ "$SYSLANG" == "nl_NL" ]; then
	echo "Language: dutch" >> /etc/mrtg/mrtg.cfg.dynamic
elif [ "$SYSLANG" == "no_NO" ]; then
	echo "Language: norwegian" >> /etc/mrtg/mrtg.cfg.dynamic
elif [ "$SYSLANG" == "pt_PT" ]; then
	echo "Language: portuguese" >> /etc/mrtg/mrtg.cfg.dynamic
elif [ "$SYSLANG" == "pt_BR" ]; then
	echo "Language: brazilian" >> /etc/mrtg/mrtg.cfg.dynamic
else 
	echo "Language: english" >> /etc/mrtg/mrtg.cfg.dynamic
fi

echo "" >> /etc/mrtg/mrtg.cfg.dynamic
echo "# Network interfaces that come and go" >> /etc/mrtg/mrtg.cfg.dynamic

ALL=`/sbin/ifconfig | grep "^[^ ]" | awk '{ print $1 }' | grep -v ^lo | grep -v ^imq | grep -v ":"`
for INTERFACE in $ALL; do
	echo "" >> /etc/mrtg/mrtg.cfg.dynamic
	echo "Options[net_$INTERFACE]: nopercent,growright,nobanner,nolegend,noinfo" >> /etc/mrtg/mrtg.cfg.dynamic
	echo "Target[net_$INTERFACE]: \`/etc/mrtg/system network $INTERFACE\`" >> /etc/mrtg/mrtg.cfg.dynamic
	echo "Title[net_$INTERFACE]: Traffic Analysis for $INTERFACE" >> /etc/mrtg/mrtg.cfg.dynamic
	echo "PageTop[net_$INTERFACE]: <h3>Traffic Analysis for $INTERFACE</h3>" >> /etc/mrtg/mrtg.cfg.dynamic
done
